[tox]
envlist =
    # Django LTS versions only
    # - Django 4.2 LTS: April 2023 - April 2026
    # - Django 5.2 LTS: April 2025 - April 2028
    py{310,311,312,313}-django{42,52}
    ruff
    pyright
    coverage
skip_missing_interpreters = true
isolated_build = true

[testenv]
description = Run tests with pytest under {basepython}
deps =
    django42: Django>=4.2,<5.0
    django52: Django>=5.2,<6.0
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    pytest-html>=4.0.0
    cryptography>=46.0.0
changedir = {toxinidir}
setenv =
    PYTHONPATH = {toxinidir}
commands =
    pytest {posargs:tests/} -v --cov=django_app_parameter --cov-report=term-missing --html=reports/{envname}/report.html --self-contained-html

[testenv:ruff]
description = Format and lint code with Ruff
deps =
    ruff>=0.8.0
commands =
    ruff check django_app_parameter/
    ruff format --check django_app_parameter/

[testenv:pyright]
description = Type check with Pyright
deps =
    Django>=4.2
    pyright>=1.1.390
    django-types>=0.22.0
    cryptography>=46.0.0
commands =
    pyright django_app_parameter/

[testenv:coverage]
description = Generate coverage report
deps =
    Django>=4.2
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    coverage[toml]>=7.3.0
    cryptography>=46.0.0
commands =
    pytest tests/ --cov=django_app_parameter --cov-report=html --cov-report=term-missing
    coverage report --fail-under=100

[testenv:dev]
description = Development environment with all tools
deps =
    Django>=4.2
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    ruff>=0.8.0
    pyright>=1.1.390
    coverage[toml]>=7.3.0
    cryptography>=46.0.0
commands =
    pytest tests/ -v

[gh-actions]
python =
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313
