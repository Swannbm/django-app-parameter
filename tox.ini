[tox]
envlist =
    py{37,38,39,310,311}-django{32,40,41,42}
    lint
    coverage
skip_missing_interpreters = true
isolated_build = true

[testenv]
description = Run tests with pytest under {basepython}
deps =
    django32: Django>=3.2,<4.0
    django40: Django>=4.0,<4.1
    django41: Django>=4.1,<4.2
    django42: Django>=4.2,<5.0
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
commands =
    pytest {posargs:tests/} -v --cov=django_app_parameter --cov-report=term-missing

[testenv:lint]
description = Run linting checks (flake8 and black)
deps =
    flake8>=6.0.0
    black>=23.0.0
commands =
    flake8 django_app_parameter/
    black --check django_app_parameter/

[testenv:format]
description = Format code with black
deps =
    black>=23.0.0
commands =
    black django_app_parameter/

[testenv:coverage]
description = Generate coverage report
deps =
    Django>=4.2
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    coverage[toml]>=7.3.0
commands =
    pytest tests/ --cov=django_app_parameter --cov-report=html --cov-report=term-missing
    coverage report --fail-under=100

[testenv:dev]
description = Development environment with all tools
deps =
    Django>=4.2
    pytest>=7.4.0
    pytest-django>=4.5.0
    pytest-cov>=4.1.0
    black>=23.0.0
    flake8>=6.0.0
    coverage[toml]>=7.3.0
commands =
    pytest tests/ -v

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
